<!DOCTYPE html>
<html>
<head>
    <title>Dippaeditori</title>
</head>
<body>

<div id="editor" style="position: absolute; top: 0px; bottom: 220px; left: 0px; right: 0px">Loading content...</div>

<div id="console" style="position: absolute; height: 200px; bottom: 20px; left: 0px; right: 0px; overflow: scroll;">
    <pre>
        
    </pre>
</div>

<div style="position: absolute; bottom: 0px;">
    <button id="save">Save</button> <a href="dippa.pdf">PDF preview</a>
</div>
<div style="position: absolute; bottom: 0px;">

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="src/ace-unmin.js" type="text/javascript" charset="utf-8"></script>
<script src="src/mode-latex.js" type="text/javascript" charset="utf-8"></script>
<script>

$(function() {
    var editor = ace.edit("editor");

    $('#save').click(function() {
        var value = JSON.stringify({value: editor.getSession().getValue()});

        $.ajax({
            type: "POST",
            url: '/save',
            dataType: 'json',
            contentType: 'application/json',
            data: value,
            processData: false,
            complete: function(response) {
                debugger;
                $('#console').find('pre').html(response.responseText);
            }
        });
    })

    $.ajax({
        url: '/load',
        success: function(content) {
            var session = editor.getSession();

            session.setValue(content);
            var LatexMode = require("ace/mode/latex").Mode;
		    session.setMode(new LatexMode());

            session.setUseWrapMode(true);
            session.setWrapLimitRange(null, 80);
        }
    });
});

</script>

</body>
</html>